<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Bellwood.DriverApp.ViewModels"
             x:Class="Bellwood.DriverApp.Views.RideDetailPage"
             x:DataType="viewmodels:RideDetailViewModel"
             Title="{Binding Title}">

    <ScrollView>
        <VerticalStackLayout Spacing="0" Padding="0">

            <!-- Header Card -->
            <Frame Margin="0" 
                   Padding="20" 
                   BackgroundColor="{StaticResource Primary}"
                   CornerRadius="0"
                   HasShadow="False">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding Ride.PassengerName}"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="White"/>
                    <Label Text="{Binding Ride.PickupDateTime, StringFormat='Pick up: {0:MMM dd, yyyy h:mm tt}'}"
                           FontSize="16"
                           TextColor="White"/>
                    <Label Text="{Binding Ride.Status}"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="White"
                           Margin="0,5,0,0"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Location Tracking Indicator -->
            <Frame IsVisible="{Binding IsTracking}"
                   BackgroundColor="{StaticResource Success}"
                   Margin="10"
                   Padding="10"
                   CornerRadius="8"
                   HasShadow="False">
                <HorizontalStackLayout Spacing="10">
                    <Label Text="ðŸ“" FontSize="16"/>
                    <Label Text="Location tracking active"
                           TextColor="White"
                           FontAttributes="Bold"/>
                </HorizontalStackLayout>
            </Frame>

            <!-- Passenger Info -->
            <Frame Margin="10" Padding="15" BackgroundColor="White" CornerRadius="8">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Passenger Information"
                           FontSize="18"
                           FontAttributes="Bold"/>
                    
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ðŸ‘¤" FontSize="16"/>
                        <Label Text="{Binding Ride.PassengerName}"
                               FontSize="16"
                               TextColor="{StaticResource Gray700}"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="ðŸ‘¥" FontSize="16"/>
                        <Label Text="{Binding Ride.PassengerCount, StringFormat='{0} passenger(s)'}"
                               FontSize="16"
                               TextColor="{StaticResource Gray700}"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Locations -->
            <Frame Margin="10" Padding="15" BackgroundColor="White" CornerRadius="8">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Locations"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <!-- Pickup -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="PICK UP" 
                               FontSize="12" 
                               TextColor="{StaticResource Gray500}"
                               FontAttributes="Bold"/>
                        <Label Text="{Binding Ride.PickupLocation}"
                               FontSize="16"/>
                        <Label Text="{Binding Ride.PickupStyle}"
                               FontSize="14"
                               TextColor="{StaticResource Gray600}"
                               IsVisible="{Binding Ride.PickupStyle, Converter={StaticResource IsNotNullConverter}}"/>
                        <Label Text="{Binding Ride.PickupSignText, StringFormat='Sign: {0}'}"
                               FontSize="14"
                               TextColor="{StaticResource Info}"
                               FontAttributes="Bold"
                               IsVisible="{Binding Ride.PickupSignText, Converter={StaticResource IsNotNullConverter}}"/>
                        <Button Text="Navigate to Pick Up"
                                Command="{Binding NavigateToPickupCommand}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                CornerRadius="8"
                                Margin="0,5,0,0"/>
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="{StaticResource Gray200}" Margin="0,5"/>

                    <!-- Dropoff -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="DROP OFF" 
                               FontSize="12" 
                               TextColor="{StaticResource Gray500}"
                               FontAttributes="Bold"/>
                        <Label Text="{Binding Ride.DropoffLocation}"
                               FontSize="16"/>
                        <Button Text="Navigate to Drop Off"
                                Command="{Binding NavigateToDropoffCommand}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                CornerRadius="8"
                                Margin="0,5,0,0"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Ride Details -->
            <Frame Margin="10" Padding="15" BackgroundColor="White" CornerRadius="8">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Ride Details"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" RowSpacing="8" ColumnSpacing="10">
                        <Label Grid.Row="0" Grid.Column="0"
                               Text="{Binding Ride.VehicleClass, StringFormat='ðŸš— {0}'}"
                               FontSize="14"/>
                        <Label Grid.Row="0" Grid.Column="1"
                               Text="{Binding Ride.PassengerCount, StringFormat='ðŸ‘¥ {0} passenger(s)'}"
                               FontSize="14"/>
                        <Label Grid.Row="1" Grid.Column="0"
                               Text="{Binding Ride.CheckedBags, StringFormat='ðŸ§³ {0} checked bag(s)'}"
                               FontSize="14"/>
                        <Label Grid.Row="1" Grid.Column="1"
                               Text="{Binding Ride.CarryOnBags, StringFormat='ðŸŽ’ {0} carry-on(s)'}"
                               FontSize="14"/>
                    </Grid>

                    <!-- Flight Info -->
                    <Label Text="{Binding Ride.OutboundFlight.FlightNumber, StringFormat='âœˆï¸ Flight: {0}'}"
                           FontSize="14"
                           IsVisible="{Binding Ride.OutboundFlight.FlightNumber, Converter={StaticResource IsNotNullConverter}}"/>

                    <!-- Special Requests -->
                    <Frame IsVisible="{Binding Ride.AdditionalRequest, Converter={StaticResource IsNotNullConverter}}"
                           BackgroundColor="{StaticResource Warning}"
                           Padding="10"
                           CornerRadius="8"
                           HasShadow="False"
                           Margin="0,5,0,0">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="ðŸ“ Special Request"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="White"/>
                            <Label Text="{Binding Ride.AdditionalRequest}"
                                   FontSize="14"
                                   TextColor="White"/>
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <!-- Status Update Buttons -->
            <Frame Margin="10" Padding="15" BackgroundColor="White" CornerRadius="8">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Update Ride Status"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Button Text="â–¶ï¸ Start Trip (On Route)"
                            Command="{Binding UpdateStatusCommand}"
                            CommandParameter="OnRoute"
                            IsVisible="{Binding CanTransitionToOnRoute}"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="8"/>

                    <Button Text="ðŸ“ Mark Arrived"
                            Command="{Binding UpdateStatusCommand}"
                            CommandParameter="Arrived"
                            IsVisible="{Binding CanTransitionToArrived}"
                            BackgroundColor="{StaticResource Info}"
                            TextColor="White"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="8"/>

                    <Button Text="ðŸš— Passenger Onboard"
                            Command="{Binding UpdateStatusCommand}"
                            CommandParameter="PassengerOnboard"
                            IsVisible="{Binding CanTransitionToPassengerOnboard}"
                            BackgroundColor="{StaticResource Success}"
                            TextColor="White"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="8"/>

                    <Button Text="âœ… Complete Ride"
                            Command="{Binding UpdateStatusCommand}"
                            CommandParameter="Completed"
                            IsVisible="{Binding CanTransitionToCompleted}"
                            BackgroundColor="{StaticResource Success}"
                            TextColor="White"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="8"/>

                    <Button Text="âŒ Cancel Ride"
                            Command="{Binding UpdateStatusCommand}"
                            CommandParameter="Cancelled"
                            IsVisible="{Binding CanCancel}"
                            BackgroundColor="{StaticResource Danger}"
                            TextColor="White"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="8"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Error Message -->
            <Label Text="{Binding ErrorMessage}"
                   TextColor="{StaticResource Danger}"
                   FontSize="14"
                   IsVisible="{Binding ErrorMessage, Converter={StaticResource IsNotNullConverter}}"
                   Margin="20,10"
                   HorizontalOptions="Center"/>

            <!-- Loading Overlay -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                              IsVisible="{Binding IsBusy}"
                              Color="{StaticResource Primary}"
                              Margin="20"/>

            <!-- Bottom spacing -->
            <BoxView HeightRequest="20"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
